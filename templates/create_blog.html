{% extends 'base.html' %}
{% load static %}

{% block title %}Create Blog Post{% endblock %}

{% block content %}
<main class="container">
    <div class="max-width-lg">
        <h1>Create Blog Post</h1>

        <div class="card">
            <div class="card-header">
                <h2>New Blog Post</h2>
                <div class="gradient-bar"></div>
            </div>

            <div class="card-body">
                {% if messages %}
                <div class="message-container">
                    {% for message in messages %}
                    <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}
                {% if blog_form.errors %}
                <div class="message-container">
                    <div class="message error">
                        Please correct the errors below:
                        <ul>
                        {% for field, errors in blog_form.errors.items %}
                            {% for error in errors %}
                            <li>{{ field|title }}: {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
                <form id="blog-form" action="{% url 'create_blog' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" id="title" name="title" class="form-input" placeholder="Enter blog title" value="{{ blog_form.title.value|default:'' }}" required>
                        <span class="error-message"></span>
                    </div>

                    <div class="form-group">
                        <label for="image" class="form-label">Featured Image</label>
                        <div class="image-upload">
                            <div class="image-preview">
                                {% if blog_form.image.value %}
                                <img src="{{ blog_form.image.value.url }}" alt="Image preview">
                                {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                {% endif %}
                            </div>
                            <div class="file-input-container">
                                <input type="file" id="image" name="image" class="file-input" accept="image/*">
                                <label for="image" class="file-label">Choose File</label>
                                <p class="file-hint">JPG, PNG or GIF, Maximum 2MB</p>
                                <span class="error-message"></span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="category" class="form-label">Category</label>
                        <select id="category" name="category" class="form-select" required>
                            <option value="">Select a category</option>
                            {% for category in blog_form.category.field.queryset %}
                            <option value="{{ category.id }}" {% if blog_form.category.value == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                            {% endfor %}
                        </select>
                        <span class="error-message"></span>
                    </div>

                    <div class="form-group">
                        <label for="summary" class="form-label">Summary</label>
                        <textarea id="summary" name="summary" rows="3" class="form-textarea" placeholder="Brief summary of the blog post" required>{{ blog_form.summary.value|default:'' }}</textarea>
                        <span class="error-message"></span>
                    </div>

                    <div class="form-group">
                        <label for="content" class="form-label">Content</label>
                        <textarea id="content" name="content" rows="8" class="form-textarea" placeholder="Write your blog content here..." required>{{ blog_form.content.value|default:'' }}</textarea>
                        <span class="error-message"></span>
                    </div>

                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="is_draft" name="is_draft" class="form-checkbox" {% if blog_form.is_draft.value %}checked{% endif %}>
                        <label for="is_draft" class="form-label" style="margin-bottom: 0;">Save as draft</label>
                        <span class="error-message"></span>
                    </div>

                    <div class="form-actions">
                        <a href="{% url 'doctor_dashboard' %}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-text">Publish Blog</span>
                            <span class="spinner hidden"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>
{% endblock %}